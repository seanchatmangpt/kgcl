#!/usr/bin/env python3
"""
AUTOGENERATED FROM .kgc â€“ DO NOT EDIT MANUALLY

This KGCT (KGC Technician) CLI is generated from RDF in {{ cli_ontology_path }}
and rendered via Jinja template .kgc/projections/cli.py.j2.

To modify commands, edit {{ cli_ontology_path }} and re-run:
    python -m kgcl.generators.cli_generator

Generated: {{ generated_at }}
Ontology: {{ kgc_ontology_path }}
CLI Spec: {{ cli_ontology_path }}
"""

import typer
from typing import Optional, List
from pathlib import Path
import sys

# Import handlers from personal_kgcl.handlers
{% for cmd in commands -%}
try:
    from personal_kgcl.handlers.{{ cmd.handler_module }} import {{ cmd.handler_function }}
except ImportError as e:
    print(f"Warning: Could not import {{ cmd.handler_module }}.{{ cmd.handler_function }}: {e}", file=sys.stderr)
{% endfor %}

# CLI App Definition
app = typer.Typer(
    name="{{ root_command.name }}",
    help="{{ root_command.help }}",
    rich_markup_mode="rich",
    no_args_is_help=True
)

# ============================================================================
# COMMANDS (auto-generated from RDF)
# ============================================================================
{% for cmd in commands %}

@app.command(name="{{ cmd.name }}")
def {{ cmd.name|replace('-', '_')|replace('.', '_') }}(
    {%- if cmd.args %}
    {% for arg in cmd.args %}
    {{ arg.name|replace('-', '_') }}: {% if arg.required %}str{% else %}Optional[str]{% endif %} = typer.Argument(
        {% if not arg.required %}None, {% endif %}
        help="{{ arg.help }}"
    ),
    {%- endfor %}
    {%- endif %}
    {%- if cmd.options %}
    {% for opt in cmd.options %}
    {{ opt.name|replace('-', '_') }}: {% if opt.required %}str{% else %}Optional[str]{% endif %} = typer.Option(
        {% if opt.default %}"{{ opt.default }}"{% else %}None{% endif %},
        "--{{ opt.name }}",
        help="{{ opt.help }}"
    ),
    {%- endfor %}
    {%- endif %}
    verbose: bool = typer.Option(False, "--verbose", "-v", help="Enable verbose output"),
    dry_run: bool = typer.Option(False, "--dry-run", help="Simulate without making changes"),
):
    """
    {{ cmd.help }}

    {% if cmd.extended_help -%}
    {{ cmd.extended_help }}
    {%- endif %}
    """
    try:
        # Build kwargs from provided args
        kwargs = {
            {% if cmd.args %}
            {% for arg in cmd.args %}
            "{{ arg.name|replace('-', '_') }}": {{ arg.name|replace('-', '_') }},
            {% endfor %}
            {% endif %}
            {% if cmd.options %}
            {% for opt in cmd.options %}
            "{{ opt.name|replace('-', '_') }}": {{ opt.name|replace('-', '_') }},
            {% endfor %}
            {% endif %}
            "verbose": verbose,
            "dry_run": dry_run,
        }

        # Remove None values
        kwargs = {k: v for k, v in kwargs.items() if v is not None}

        # Call handler
        result = {{ cmd.handler_function }}(**kwargs)

        if result is not None:
            typer.echo(result)

    except KeyboardInterrupt:
        typer.echo("\nAborted.", err=True)
        sys.exit(1)
    except Exception as e:
        if verbose:
            import traceback
            traceback.print_exc()
        else:
            typer.echo(f"Error: {str(e)}", err=True)
        sys.exit(1)

{% endfor %}

# ============================================================================
# CALLBACK (runs before any command)
# ============================================================================

@app.callback(invoke_without_command=True)
@app.callback()
def main(
    ctx: typer.Context,
    version: bool = typer.Option(False, "--version", help="Show version"),
):
    """
    {{ root_command.help }}

    KGC Technician Console for personal macOS/iOS productivity fabric.
    All operations driven by RDF ontology in .kgc/
    """
    if version:
        typer.echo("{{ app_version }}")
        raise typer.Exit()

# ============================================================================
# ENTRY POINT
# ============================================================================

if __name__ == "__main__":
    app()
